---
phase: 11-hssp-compliance
plan: 02
type: execute
wave: 2
depends_on:
  - "11-01"
files_modified:
  - client/src/lib/types.ts
  - client/src/components/sheet/SheetTable.tsx
  - client/src/components/sheet/InlineCreateRow.tsx
  - client/src/components/sheet/InlineEditRow.tsx
  - client/src/components/request/RequestInfo.tsx
  - client/src/pages/ProgramListPage.tsx
  - client/src/pages/ComplianceReviewPage.tsx
  - client/src/pages/SheetViewPage.tsx
  - client/src/App.tsx
autonomous: true
requirements:
  - HSSP-01
  - HSSP-02
  - HSSP-03
  - HSSP-04

must_haves:
  truths:
    - "Checklist fields render as a group of labeled checkboxes in inline create and edit rows"
    - "Request detail page shows checklist fields with each item's checked/unchecked state"
    - "Programs tagged with a compliance type show a compliance badge in the program list"
    - "Compliance review page shows per-request checklist completion percentages and an overall summary"
    - "Sheet view shows a completion percentage column for each checklist field"
  artifacts:
    - path: "client/src/lib/types.ts"
      provides: "FieldType extended with 'checklist', ChecklistItem type, Program.complianceType"
      contains: "checklist"
    - path: "client/src/components/sheet/SheetTable.tsx"
      provides: "formatFieldValue handles checklist with completion percentage display"
      contains: "checklist"
    - path: "client/src/pages/ComplianceReviewPage.tsx"
      provides: "Compliance review page with aggregated completion table and summary card"
      contains: "ComplianceReviewPage"
    - path: "client/src/pages/ProgramListPage.tsx"
      provides: "Compliance type badge on program cards"
      contains: "complianceType"
    - path: "client/src/App.tsx"
      provides: "Route for /programs/:programId/compliance-review"
      contains: "compliance-review"
  key_links:
    - from: "client/src/pages/ComplianceReviewPage.tsx"
      to: "/api/v1/programs/:programId/requests/compliance-review"
      via: "api.get fetch on mount"
      pattern: "compliance-review"
    - from: "client/src/components/sheet/SheetTable.tsx"
      to: "client/src/lib/types.ts"
      via: "formatFieldValue switch case for checklist"
      pattern: "case 'checklist'"
    - from: "client/src/pages/ProgramListPage.tsx"
      to: "client/src/lib/types.ts"
      via: "Program.complianceType for badge rendering"
      pattern: "complianceType"
---

<objective>
Add frontend support for HSSP compliance: checklist field rendering in forms and detail views, compliance type badge on programs, completion percentage column in sheet view, and a dedicated compliance review page.

Purpose: Users can interact with checklist fields (create, edit, view), see which programs are compliance-tagged at a glance, and open a compliance review page that shows aggregated completion data across all requests.

Output: Updated client types, checklist rendering in all field surfaces (inline create/edit, sheet table, request detail), compliance badge on program list cards, new ComplianceReviewPage with route, and completion percentage display in sheet view.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-hssp-compliance/11-01-SUMMARY.md

@client/src/lib/types.ts
@client/src/components/sheet/SheetTable.tsx
@client/src/components/sheet/InlineCreateRow.tsx
@client/src/components/sheet/InlineEditRow.tsx
@client/src/components/request/RequestInfo.tsx
@client/src/pages/ProgramListPage.tsx
@client/src/pages/SheetViewPage.tsx
@client/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update client types and add checklist rendering in sheet table, inline rows, and request detail</name>
  <files>
    client/src/lib/types.ts
    client/src/components/sheet/SheetTable.tsx
    client/src/components/sheet/InlineCreateRow.tsx
    client/src/components/sheet/InlineEditRow.tsx
    client/src/components/request/RequestInfo.tsx
  </files>
  <action>
**client/src/lib/types.ts:**
1. Add `'checklist'` to the `FieldType` union type.
2. Add `items?: string[]` to the `FieldDefinition` interface (checklist item labels template).
3. Add `complianceType?: 'hssp' | null` to the `Program` interface.
4. Add a new exported type: `ChecklistItem = { label: string; checked: boolean }`.

**SheetTable.tsx -- formatFieldValue:**
5. Add `case 'checklist':` to the `formatFieldValue` function. If value is an array, count total and checked items, compute percentage, and render:
   - A small inline display: `<span className="text-sm">{checked}/{total} <span className="text-muted-foreground">({percentage}%)</span></span>`
   - Use a small colored indicator: if percentage === 100 show green check icon, if percentage === 0 show red/muted, otherwise show the percentage text.
   - If value is not an array, return `'-'`.

**SheetTable.tsx -- SORTABLE_FIELD_TYPES:**
6. Do NOT add 'checklist' to SORTABLE_FIELD_TYPES (checklist columns are informational, not sortable -- consistent with chain column pattern from Phase 10).

**InlineCreateRow.tsx -- renderFieldInput:**
7. Add `case 'checklist':` to the `renderFieldInput` function. Render a column of checkboxes with labels based on the field definition's `items` array. Each checkbox toggles its item in the fields state. Store checklist value as `Array<{label: string, checked: boolean}>` in the fields record:
   ```tsx
   case 'checklist':
     return (
       <div className="space-y-1 max-h-[120px] overflow-auto">
         {(def.items || []).map((item) => {
           const currentVal = (fields[def.key] as ChecklistItem[] | undefined) || [];
           const itemState = currentVal.find(ci => ci.label === item);
           const isChecked = itemState?.checked ?? false;
           return (
             <label key={item} className="flex items-center gap-1.5 text-xs cursor-pointer">
               <input
                 type="checkbox"
                 className="h-3.5 w-3.5"
                 checked={isChecked}
                 onChange={(e) => {
                   const existing = (fields[def.key] as ChecklistItem[] | undefined) ||
                     (def.items || []).map(i => ({ label: i, checked: false }));
                   const updated = existing.map(ci =>
                     ci.label === item ? { ...ci, checked: e.target.checked } : ci
                   );
                   updateField(def.key, updated);
                 }}
               />
               <span className="truncate">{item}</span>
             </label>
           );
         })}
       </div>
     );
   ```
   Initialize the checklist value with all items unchecked when the field is first interacted with. Import `ChecklistItem` from `@/lib/types`.

**InlineEditRow.tsx:**
8. Apply the same `case 'checklist':` rendering as InlineCreateRow. The edit row should load existing checklist values from `request.fields[def.key]` and render checkboxes with their current state. Import `ChecklistItem` from `@/lib/types`.

**RequestInfo.tsx -- formatFieldValue:**
9. Update the `formatFieldValue` function to handle `'checklist'` type. Instead of returning a simple string, return a descriptive string: if value is an array, count checked/total, return `"X of Y completed (Z%)"`. If not an array, return `'-'`.
10. Also update the custom fields section to render checklist fields with more detail. For checklist fields, instead of the simple `<p>` text, render a mini checklist display:
    ```tsx
    {def.type === 'checklist' && Array.isArray(request.fields[def.key]) ? (
      <div className="space-y-0.5 mt-1">
        {(request.fields[def.key] as ChecklistItem[]).map((item, idx) => (
          <div key={idx} className="flex items-center gap-1.5 text-xs">
            {item.checked ? (
              <Check className="h-3 w-3 text-green-600" />
            ) : (
              <Minus className="h-3 w-3 text-muted-foreground" />
            )}
            <span className={item.checked ? '' : 'text-muted-foreground'}>{item.label}</span>
          </div>
        ))}
      </div>
    ) : (
      <p className="font-medium">{formatFieldValue(request.fields[def.key], def.type)}</p>
    )}
    ```
    Import `ChecklistItem` from `@/lib/types` and `Check`, `Minus` from `lucide-react`.
  </action>
  <verify>
1. Run `npx tsc --noEmit` from the client directory -- must compile with no errors.
2. Verify FieldType includes 'checklist' in types.ts.
3. Verify SheetTable.tsx formatFieldValue has case 'checklist'.
4. Verify InlineCreateRow.tsx and InlineEditRow.tsx both have case 'checklist' in renderFieldInput.
5. Verify RequestInfo.tsx handles checklist display with item-level detail.
  </verify>
  <done>
Client types include checklist field type and ChecklistItem. Sheet table shows completion percentage for checklist columns. Inline create/edit rows render checklist as checkboxes from field definition items. Request detail shows per-item checked/unchecked state. TypeScript compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Compliance badge on program list, compliance review page, and route registration</name>
  <files>
    client/src/pages/ProgramListPage.tsx
    client/src/pages/ComplianceReviewPage.tsx
    client/src/pages/SheetViewPage.tsx
    client/src/App.tsx
  </files>
  <action>
**ProgramListPage.tsx:**
1. Show a compliance type badge on program cards when `program.complianceType` is set. Add it next to the existing status badge in the card header:
   ```tsx
   {program.complianceType && (
     <Badge variant="outline" className="border-blue-400 text-blue-600 dark:text-blue-400 text-[10px] uppercase">
       {program.complianceType}
     </Badge>
   )}
   ```
   Place it between the program name and the status badge. This provides at-a-glance compliance identification.

**SheetViewPage.tsx:**
2. Add a "Compliance Review" button in the header actions (next to Calendar and Activity buttons), visible only when the program has a complianceType set:
   ```tsx
   {program.complianceType && (
     <Button
       variant="outline"
       size="sm"
       onClick={() => navigate(`/programs/${programId}/compliance-review`)}
     >
       <ClipboardCheck className="h-4 w-4 mr-1" />
       Compliance
     </Button>
   )}
   ```
   Import `ClipboardCheck` from `lucide-react`.

**ComplianceReviewPage.tsx (NEW FILE):**
3. Create `client/src/pages/ComplianceReviewPage.tsx` with the following structure:
   - Fetch compliance review data from `GET /programs/:programId/requests/compliance-review` on mount.
   - Layout:
     a. **Header** with back button to sheet view, program name, and "Compliance Review" title.
     b. **Summary card** (Card component) showing: total requests count, overall average completion percentage as a large number with a colored indicator (green >= 80%, orange 50-79%, red < 50%).
     c. **Checklist fields overview** section: for each checklist field, show field label and the average completion across all requests.
     d. **Requests table** (Table component) with columns: Title, Status, and one column per checklist field showing "X/Y (Z%)" with color coding. Add an "Overall" column showing the request's overallPercentage.
     - Sort requests by overallPercentage ascending (lowest completion first) so incomplete items are at the top.
   - States: loading (skeleton), error, empty (no checklist fields or no requests).
   - Use existing UI components: Card, CardHeader, CardTitle, CardContent, Table, TableHeader, TableRow, TableHead, TableBody, TableCell, Badge, Button, Skeleton.
   - Import `useParams`, `useNavigate` from react-router-dom, `api` from `@/lib/api`.
   - Type the API response:
     ```typescript
     interface ComplianceReviewData {
       checklistFields: Array<{ key: string; label: string; items?: string[] }>;
       requests: Array<{
         requestId: string;
         title: string;
         status: string;
         completions: Record<string, { total: number; checked: number; percentage: number }>;
         overallPercentage: number;
       }>;
       summary: { totalRequests: number; averageCompletion: number };
     }
     ```
   - Color coding for completion badges: percentage >= 80 green, >= 50 orange, < 50 red (reuse pattern from due date indicators).

**App.tsx:**
4. Add the compliance review route. Place it BEFORE the generic `/:programId/requests/:requestId` route to prevent misparse (same pattern as import/history):
   ```tsx
   <Route
     path="/programs/:programId/compliance-review"
     element={<ComplianceReviewPage />}
   />
   ```
   Import `ComplianceReviewPage` from `@/pages/ComplianceReviewPage`.
  </action>
  <verify>
1. Run `npx tsc --noEmit` from the client directory -- must compile with no errors.
2. Verify ProgramListPage.tsx renders complianceType badge.
3. Verify ComplianceReviewPage.tsx exists and exports the page component.
4. Verify App.tsx has the /compliance-review route registered before /:requestId.
5. Verify SheetViewPage.tsx has the compliance review button conditional on complianceType.
  </verify>
  <done>
Program list shows HSSP compliance badge on tagged programs. Sheet view header shows "Compliance" button for compliance-tagged programs. Compliance review page shows summary card with average completion, per-field averages, and per-request completion table sorted by completion. Route registered in App.tsx. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd client && npx tsc --noEmit` passes with 0 errors
2. FieldType in types.ts includes 'checklist'
3. Program interface has complianceType field
4. SheetTable formatFieldValue renders checklist as completion percentage
5. InlineCreateRow and InlineEditRow render checklist as checkboxes
6. RequestInfo shows per-item checklist state
7. ProgramListPage shows compliance badge
8. ComplianceReviewPage fetches and displays aggregated data
9. App.tsx has /compliance-review route
10. SheetViewPage has Compliance button for tagged programs
</verification>

<success_criteria>
- Checklist fields render as interactive checkboxes in inline create and edit rows
- Sheet view shows "X/Y (Z%)" for checklist field columns
- Request detail page shows individual checklist items with check/uncheck state
- Programs with complianceType show an uppercase badge (e.g., "HSSP") in program list
- Compliance review page accessible from sheet view header for compliance-tagged programs
- Compliance review page shows summary stats and per-request completion breakdown
- All TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/11-hssp-compliance/11-02-SUMMARY.md`
</output>
