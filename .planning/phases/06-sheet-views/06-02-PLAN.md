---
phase: 06-sheet-views
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - client/package.json
  - client/src/main.tsx
  - client/src/App.tsx
  - client/src/lib/api.ts
  - client/src/lib/auth.tsx
  - client/src/lib/types.ts
  - client/src/pages/LoginPage.tsx
  - client/src/pages/ProgramListPage.tsx
  - client/src/components/layout/AppLayout.tsx
  - client/src/components/layout/Sidebar.tsx
  - client/src/components/layout/Header.tsx
  - client/src/components/ui/button.tsx
  - client/src/components/ui/input.tsx
  - client/src/components/ui/label.tsx
  - client/src/components/ui/card.tsx
  - client/src/components/ui/badge.tsx
  - client/src/components/ui/skeleton.tsx
  - client/src/components/ui/sonner.tsx
autonomous: true
requirements:
  - SHEET-01

must_haves:
  truths:
    - "User can navigate to login page, enter credentials, and be redirected to the program list"
    - "User sees a list of programs they have access to after logging in"
    - "User can click a program to navigate to the sheet view URL"
    - "Unauthenticated users are redirected to the login page"
    - "JWT access token is refreshed automatically when expired"
  artifacts:
    - path: "client/src/lib/api.ts"
      provides: "Axios-based API client with JWT interceptor and refresh logic"
      contains: "api.interceptors"
    - path: "client/src/lib/auth.tsx"
      provides: "AuthContext with login, logout, token management, and ProtectedRoute"
      contains: "AuthProvider"
    - path: "client/src/lib/types.ts"
      provides: "Shared TypeScript interfaces for User, Program, Request, PaginatedResponse"
      contains: "interface Program"
    - path: "client/src/pages/LoginPage.tsx"
      provides: "Login form with email/password, error handling, redirect to /programs"
      contains: "LoginPage"
    - path: "client/src/pages/ProgramListPage.tsx"
      provides: "Card grid of user's accessible programs with link to sheet view"
      contains: "ProgramListPage"
    - path: "client/src/components/layout/AppLayout.tsx"
      provides: "Main layout with sidebar and header wrapping Outlet"
      contains: "AppLayout"
  key_links:
    - from: "client/src/lib/api.ts"
      to: "/api/v1/auth"
      via: "axios interceptor for token refresh"
      pattern: "api/v1/auth/refresh"
    - from: "client/src/lib/auth.tsx"
      to: "client/src/lib/api.ts"
      via: "login/logout API calls"
      pattern: "api\\.post.*auth"
    - from: "client/src/App.tsx"
      to: "client/src/pages/ProgramListPage.tsx"
      via: "React Router route definition"
      pattern: "Route.*path.*programs"
---

<objective>
Bootstrap the React client application with authentication, routing, API client, and navigation to provide the foundation for the sheet view.

Purpose: The client is currently bare scaffolding (just an App.tsx placeholder). Phase 6 needs a complete working client with auth, navigation, and program selection before the sheet view can be built.

Output: Working React app with login, JWT auth, program list, layout shell, and routing to sheet view pages.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@client/package.json
@client/src/App.tsx
@client/src/main.tsx
@client/src/lib/utils.ts
@client/vite.config.ts
@client/tsconfig.app.json
@client/components.json
@server/src/modules/auth/auth.routes.ts
@server/src/modules/program/program.routes.ts
@server/src/shared/types.ts
@server/src/middleware/pagination.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install client dependencies and create API client, types, and auth context</name>
  <files>
    client/package.json
    client/src/lib/api.ts
    client/src/lib/types.ts
    client/src/lib/auth.tsx
  </files>
  <action>
    **Install dependencies (run from client/ directory):**
    ```bash
    npm install react-router-dom@6 axios@1 sonner@1
    npm install -D @types/react-router-dom
    ```

    Also add shadcn/ui components needed for this plan and future plans. Run from client/ directory:
    ```bash
    npx shadcn@latest add button input label card badge skeleton -y
    ```
    If shadcn CLI does not work or is not available, manually create the component files under `client/src/components/ui/` following shadcn/ui new-york style conventions (using the cn utility from @/lib/utils, CVA for variants, Radix primitives where needed).

    **client/src/lib/types.ts — Shared TypeScript interfaces:**
    Define interfaces matching the server's data shapes:
    ```typescript
    export type Role = 'admin' | 'manager' | 'team_member' | 'client';
    export type ProgramRole = 'manager' | 'team_member' | 'client';
    export type RequestStatus = 'draft' | 'submitted' | 'in_review' | 'approved' | 'rejected' | 'completed';
    export type RequestPriority = 'low' | 'medium' | 'high' | 'urgent';
    export type FieldType = 'text' | 'number' | 'date' | 'dropdown' | 'checkbox' | 'file_upload';

    export interface User {
      _id: string;
      email: string;
      firstName: string;
      lastName: string;
      role: Role;
      isActive: boolean;
    }

    export interface FieldDefinition {
      key: string;
      label: string;
      type: FieldType;
      required: boolean;
      options?: string[];
      placeholder?: string;
      order: number;
    }

    export interface Program {
      _id: string;
      name: string;
      description?: string;
      fieldDefinitions: FieldDefinition[];
      settings: { allowClientSubmission: boolean; requireApproval: boolean; maxActiveRequests?: number };
      timeframes: { startDate?: string; endDate?: string };
      status: 'active' | 'archived';
      createdBy: string | { _id: string; firstName: string; lastName: string };
    }

    export interface RequestItem {
      _id: string;
      programId: string | { _id: string; name: string };
      title: string;
      description?: string;
      status: RequestStatus;
      fields: Record<string, unknown>;
      createdBy: string | { _id: string; firstName: string; lastName: string; email: string };
      assignedTo?: string | { _id: string; firstName: string; lastName: string; email: string } | null;
      priority: RequestPriority;
      createdAt: string;
      updatedAt: string;
    }

    export interface PaginatedResponse<T> {
      data: T[];
      pagination: { page: number; limit: number; total: number; pages: number };
    }
    ```

    **client/src/lib/api.ts — Axios API client with JWT interceptor:**
    - Create axios instance with `baseURL: '/api/v1'` and `withCredentials: true`.
    - Store access token in module-level variable (not localStorage — security best practice). Export `setAccessToken(token: string | null)` and `getAccessToken()`.
    - Add request interceptor: if accessToken exists, set `Authorization: Bearer ${accessToken}`.
    - Add response interceptor: on 401 error, attempt a `POST /api/v1/auth/refresh` (with `withCredentials: true` so the HttpOnly refresh cookie is sent). If refresh succeeds, extract new accessToken from response.data.accessToken, call setAccessToken, and retry the original request. If refresh fails, clear token and redirect to /login.
    - Use a flag `isRefreshing` to prevent multiple simultaneous refresh attempts. Queue failed requests while refreshing and replay them after token refresh succeeds.
    - Export the axios instance as default export `api`.

    **client/src/lib/auth.tsx — AuthContext and ProtectedRoute:**
    - Create AuthContext with `{ user: User | null; login: (email, password) => Promise<void>; logout: () => Promise<void>; isLoading: boolean }`.
    - AuthProvider:
      - On mount, call `GET /api/v1/auth/me` to check for existing session (the refresh cookie may be valid). If succeeds, set user + accessToken. If fails, set user to null.
      - `login(email, password)`: POST to `/api/v1/auth/login`, extract user and accessToken from response, set both in state. The server sets the refresh token as an HttpOnly cookie automatically.
      - `logout()`: POST to `/api/v1/auth/logout`, clear user and accessToken, navigate to /login.
      - `isLoading`: true during initial auth check, false after.
    - ProtectedRoute component: If isLoading, show a spinner/skeleton. If no user, redirect to /login via Navigate. Otherwise, render `<Outlet />`.
  </action>
  <verify>
    Run `cd client && npx tsc --noEmit` — no type errors (note: pages and App.tsx may have errors if they reference components not yet created — that's OK, will be fixed in Task 2). Verify api.ts exports `api` and `setAccessToken`. Verify auth.tsx exports `AuthProvider`, `useAuth`, and `ProtectedRoute`.
  </verify>
  <done>
    api.ts provides Axios client with automatic JWT refresh. auth.tsx provides AuthContext with login/logout/session-check. types.ts provides all shared interfaces. Dependencies (react-router-dom, axios, sonner) installed. shadcn/ui base components generated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create layout shell, login page, program list page, and wire routing</name>
  <files>
    client/src/App.tsx
    client/src/main.tsx
    client/src/pages/LoginPage.tsx
    client/src/pages/ProgramListPage.tsx
    client/src/components/layout/AppLayout.tsx
    client/src/components/layout/Sidebar.tsx
    client/src/components/layout/Header.tsx
    client/src/components/ui/sonner.tsx
  </files>
  <action>
    **client/src/components/ui/sonner.tsx — Sonner toast integration:**
    Create a thin wrapper that re-exports sonner's Toaster component with the project's theme. Use `<Toaster richColors position="top-right" />`.

    **client/src/components/layout/Sidebar.tsx:**
    - Fixed left sidebar (w-64) with:
      - App logo/name "RMS" at top
      - Navigation links: "Programs" (icon: LayoutGrid), "Notifications" (icon: Bell) — use lucide-react icons
      - User section at bottom showing user name and role (from useAuth context)
      - Logout button
    - Use Tailwind classes consistent with shadcn/ui theme (bg-card, text-card-foreground, border-border).
    - NavLink from react-router-dom for active state styling.

    **client/src/components/layout/Header.tsx:**
    - Top header bar showing:
      - Breadcrumb or page title (from a simple context or just static text, can be enhanced later)
      - User avatar placeholder (first letter of name) with role badge

    **client/src/components/layout/AppLayout.tsx:**
    - Flex container with Sidebar on left and main content area on right.
    - Main area includes Header at top and `<Outlet />` below for page content.
    - Wrap in a div with `min-h-screen bg-background`.

    **client/src/pages/LoginPage.tsx:**
    - Centered card (max-w-md) with:
      - "RMS" heading and "Sign in to your account" subtitle
      - Email input (type email, required)
      - Password input (type password, required)
      - Submit button with loading state
      - Error message display (from API error response)
    - On submit, call `login(email, password)` from useAuth.
    - On success, navigate to `/programs` using react-router-dom useNavigate.
    - If user is already logged in (useAuth().user), redirect to /programs.
    - Use shadcn/ui Card, Input, Label, Button components.

    **client/src/pages/ProgramListPage.tsx:**
    - Fetch programs from `GET /api/v1/programs` on mount using api client.
    - Display as a grid of cards (grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4).
    - Each card shows: program name, description (truncated), field count, status badge.
    - Clicking a card navigates to `/programs/:programId/sheet` using react-router-dom Link.
    - Loading state: show skeleton cards while fetching.
    - Empty state: "No programs found" message.

    **client/src/App.tsx — React Router configuration:**
    ```tsx
    import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
    import { AuthProvider } from '@/lib/auth';
    import { ProtectedRoute } from '@/lib/auth';
    import { Toaster } from '@/components/ui/sonner';
    import { AppLayout } from '@/components/layout/AppLayout';
    import { LoginPage } from '@/pages/LoginPage';
    import { ProgramListPage } from '@/pages/ProgramListPage';

    export default function App() {
      return (
        <BrowserRouter>
          <AuthProvider>
            <Routes>
              <Route path="/login" element={<LoginPage />} />
              <Route element={<ProtectedRoute />}>
                <Route element={<AppLayout />}>
                  <Route path="/programs" element={<ProgramListPage />} />
                  <Route path="/programs/:programId/sheet" element={<div>Sheet View (coming in 06-03)</div>} />
                  <Route path="/" element={<Navigate to="/programs" replace />} />
                </Route>
              </Route>
            </Routes>
            <Toaster />
          </AuthProvider>
        </BrowserRouter>
      );
    }
    ```

    **client/src/main.tsx:** No changes needed (already renders <App />).
  </action>
  <verify>
    Run `cd client && npx tsc --noEmit` — no type errors. Run `cd client && npm run build` — builds without errors. Manually verify that navigating to / redirects to /login (unauthenticated) or /programs (authenticated). Verify /programs/:programId/sheet route exists (placeholder content).
  </verify>
  <done>
    Login page authenticates users via JWT. Program list page shows accessible programs. Layout shell has sidebar with navigation and header. React Router handles protected routes with redirect to login. Sheet view route placeholder exists at /programs/:programId/sheet.
  </done>
</task>

</tasks>

<verification>
1. `cd client && npx tsc --noEmit` passes
2. `cd client && npm run build` succeeds
3. Login page submits credentials to POST /api/v1/auth/login and stores JWT
4. API client automatically refreshes expired access tokens via POST /api/v1/auth/refresh
5. Unauthenticated users are redirected to /login
6. Program list page fetches and displays programs from GET /api/v1/programs
7. Clicking a program navigates to /programs/:programId/sheet
8. Sidebar shows user name and provides logout functionality
</verification>

<success_criteria>
- Client app compiles and builds without errors
- Login flow works end-to-end (login -> JWT -> protected routes -> auto-refresh)
- Program list shows only programs the user has access to
- Navigation routes are properly configured (/, /login, /programs, /programs/:programId/sheet)
- Layout shell is visually consistent with shadcn/ui new-york theme
</success_criteria>

<output>
After completion, create `.planning/phases/06-sheet-views/06-02-SUMMARY.md`
</output>
