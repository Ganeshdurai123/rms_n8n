---
phase: 07-request-books
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - client/src/pages/ImportHistoryPage.tsx
  - client/src/components/import/ImportHistoryTable.tsx
  - client/src/App.tsx
autonomous: true
requirements:
  - BOOK-05

must_haves:
  truths:
    - "User can view a list of past imports for a program with who imported, when, row counts, and status"
    - "Import history is paginated and accessible from the sheet view"
  artifacts:
    - path: "client/src/pages/ImportHistoryPage.tsx"
      provides: "Import history page with data fetching and pagination"
      min_lines: 50
    - path: "client/src/components/import/ImportHistoryTable.tsx"
      provides: "Table rendering import job records with status badges"
      min_lines: 40
  key_links:
    - from: "client/src/pages/ImportHistoryPage.tsx"
      to: "/api/v1/programs/:programId/requests/import/history"
      via: "api.get for fetching paginated import history"
      pattern: "api\\.get.*import/history"
    - from: "client/src/App.tsx"
      to: "client/src/pages/ImportHistoryPage.tsx"
      via: "React Router route definition"
      pattern: "ImportHistoryPage"
---

<objective>
Build the import history UI: a page showing past import jobs for a program with metadata (who, when, counts, status) and navigation from the sheet toolbar.

Purpose: Provides visibility into import history so users can track who imported what and when, including success/error counts -- fulfilling the BOOK-05 tracking requirement.

Output: ImportHistoryPage with paginated table of import jobs, route integration, and toolbar link.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-request-books/07-01-SUMMARY.md
@.planning/phases/07-request-books/07-02-SUMMARY.md

@client/src/App.tsx
@client/src/lib/api.ts
@client/src/lib/types.ts
@client/src/pages/SheetViewPage.tsx
@client/src/components/sheet/SheetToolbar.tsx
@client/src/components/sheet/SheetPagination.tsx
@client/src/components/ui/table.tsx
@client/src/components/ui/badge.tsx
@client/src/components/ui/button.tsx
@client/src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Import history page and table component</name>
  <files>
    client/src/pages/ImportHistoryPage.tsx
    client/src/components/import/ImportHistoryTable.tsx
    client/src/App.tsx
    client/src/components/sheet/SheetToolbar.tsx
  </files>
  <action>
1. Create `client/src/components/import/ImportHistoryTable.tsx`:
   - Props: `imports: ImportJob[]`, `isLoading: boolean`
   - Renders a Table (shadcn/ui) with columns:
     - File Name: originalFilename (truncated to 40 chars with ellipsis if longer)
     - Imported By: performedBy (firstName + lastName if populated, or "Unknown")
     - Date: createdAt formatted as locale date+time string (e.g., "Feb 23, 2026, 2:30 PM")
     - Total Rows: totalRows
     - Imported: successCount (in green text)
     - Errors: errorCount (in red text if > 0, gray otherwise)
     - Status: Badge component with color coding:
       - 'completed' = green badge "Completed"
       - 'validated' = blue badge "Validated"
       - 'pending' = yellow badge "Pending"
       - 'failed' = red badge "Failed"
   - Loading state: show Skeleton rows (4 rows with skeleton cells) when isLoading is true
   - Empty state: "No imports yet" message with file icon when imports array is empty and not loading
   - Table styled consistently with the sheet table (same Table component)

2. Create `client/src/pages/ImportHistoryPage.tsx`:
   - Route param: programId from useParams
   - State: imports (ImportJob[]), total (number), page (number, default 1), limit (20), isLoading (boolean)
   - Fetch import history on mount and when page changes: GET /programs/${programId}/requests/import/history?page=${page}&limit=${limit}
   - Use the same useEffect data-fetching pattern with cancellation flag as other pages
   - Page layout:
     - Header: "Import History" title with program name subtitle (fetch program data on mount)
     - "Back to Sheet" link navigating to /programs/${programId}/sheet
     - "New Import" button navigating to /programs/${programId}/import
     - ImportHistoryTable component with the fetched data
     - SheetPagination component (reuse from sheet) for page navigation at bottom
   - Wrap in Card component for consistent styling

3. Update `client/src/App.tsx`:
   - Import ImportHistoryPage
   - Add route: `<Route path="/programs/:programId/import/history" element={<ImportHistoryPage />} />`
   - Place it inside the ProtectedRoute + AppLayout section
   - IMPORTANT: Place this route BEFORE the /programs/:programId/import route so React Router matches /import/history before /import

4. Update `client/src/components/sheet/SheetToolbar.tsx`:
   - Add an "Import History" button (or a small link/icon) next to the "Import" button
   - Use lucide-react History or ClockIcon
   - On click: navigate to /programs/${programId}/import/history
   - Style: ghost or link variant, smaller than Import button since it's a secondary action
   - Alternatively: make the Import button a dropdown with two options: "Import File" and "Import History" (using DropdownMenu component). This is cleaner if toolbar space is limited. Decision at Claude's discretion.
  </action>
  <verify>
    - `cd client && npx tsc --noEmit` compiles without errors
    - Navigate to /programs/:programId/import/history shows paginated import history table
    - Import history accessible from sheet toolbar
    - Status badges render with correct colors
    - Pagination works (page changes trigger new API call)
  </verify>
  <done>
    Import history page renders paginated table of past import jobs with file name, importer, date, row counts, and status badges. Page is accessible from sheet toolbar and from import wizard result step. Pagination reuses existing SheetPagination component.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd client && npx tsc --noEmit` passes
2. Navigate to /programs/:programId/import/history shows paginated import history
3. Table shows correct metadata: filename, importer, date, counts, status
4. Status badges display with appropriate colors
5. Pagination controls work and trigger data refresh
6. Navigation links work: "Back to Sheet", "New Import", toolbar buttons
</verification>

<success_criteria>
- User can view paginated import history for a program
- Each import record shows who imported, when, total rows, success count, error count, and status
- Import history is accessible from the sheet toolbar
- Page is paginated using the existing SheetPagination component
</success_criteria>

<output>
After completion, create `.planning/phases/07-request-books/07-03-SUMMARY.md`
</output>
